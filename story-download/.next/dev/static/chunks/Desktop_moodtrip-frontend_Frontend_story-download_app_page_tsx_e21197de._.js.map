{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/kangtaehun/Desktop/moodtrip-frontend/Frontend/story-download/app/page.tsx"],"sourcesContent":["\"use client\";\n\nimport { useState, useCallback } from \"react\";\nimport { createClient } from \"@supabase/supabase-js\";\n\n// Supabase 클라이언트 (환경변수에서)\nconst supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL || \"\";\nconst supabaseAnonKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY || \"\";\nconst supabase = createClient(supabaseUrl, supabaseAnonKey);\n\n// Backend API URL\nconst BACKEND_URL =\n  process.env.NEXT_PUBLIC_BACKEND_URL ||\n  \"https://moodtrip-production.up.railway.app\";\n\ninterface StoryCard {\n  name: string;\n  publicUrl: string;\n  createdAt: string;\n}\n\nexport default function Home() {\n  const [nickname, setNickname] = useState(\"\");\n  const [isLoading, setIsLoading] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n  const [storyCards, setStoryCards] = useState<StoryCard[]>([]);\n  const [userName, setUserName] = useState<string | null>(null);\n\n  // 닉네임으로 user_id 조회 및 스토리 카드 가져오기\n  const handleSearch = useCallback(async () => {\n    if (!nickname.trim()) {\n      setError(\"닉네임을 입력해주세요\");\n      return;\n    }\n\n    setIsLoading(true);\n    setError(null);\n    setStoryCards([]);\n    setUserName(null);\n\n    try {\n      // 1. 백엔드 API로 user_id 조회\n      const lookupResponse = await fetch(\n        `${BACKEND_URL}/api/users/lookup?name=${encodeURIComponent(nickname.trim())}`\n      );\n\n      if (!lookupResponse.ok) {\n        if (lookupResponse.status === 404) {\n          setError(\"해당 닉네임을 찾을 수 없습니다\");\n        } else {\n          setError(\"사용자 조회 중 오류가 발생했습니다\");\n        }\n        setIsLoading(false);\n        return;\n      }\n\n      // API 응답: { count: number, users: [{ user_id, username, created_at }] }\n      const userData = await lookupResponse.json();\n\n      if (!userData.users || userData.users.length === 0) {\n        setError(\"사용자를 찾을 수 없습니다\");\n        setIsLoading(false);\n        return;\n      }\n\n      const firstUser = userData.users[0];\n      const userId = firstUser.user_id;\n\n      if (!userId) {\n        setError(\"사용자 정보를 가져올 수 없습니다\");\n        setIsLoading(false);\n        return;\n      }\n\n      setUserName(firstUser.username || nickname);\n\n      // 2. Supabase Storage에서 사용자의 스토리 카드 조회\n      const { data: files, error: storageError } = await supabase.storage\n        .from(\"user-story\")\n        .list(userId, {\n          limit: 100,\n          sortBy: { column: \"created_at\", order: \"desc\" },\n        });\n\n      if (storageError) {\n        console.error(\"Storage 조회 오류:\", storageError);\n        setError(\"스토리 카드를 불러오는 중 오류가 발생했습니다\");\n        setIsLoading(false);\n        return;\n      }\n\n      if (!files || files.length === 0) {\n        setError(\"저장된 스토리 카드가 없습니다\");\n        setIsLoading(false);\n        return;\n      }\n\n      // PNG 파일만 필터링 및 URL 생성\n      const cards: StoryCard[] = files\n        .filter((file) => file.name.endsWith(\".png\"))\n        .map((file) => {\n          const { data: urlData } = supabase.storage\n            .from(\"user-story\")\n            .getPublicUrl(`${userId}/${file.name}`);\n\n          return {\n            name: file.name,\n            publicUrl: urlData.publicUrl,\n            createdAt: file.created_at || new Date().toISOString(),\n          };\n        });\n\n      if (cards.length === 0) {\n        setError(\"저장된 스토리 카드가 없습니다\");\n        setIsLoading(false);\n        return;\n      }\n\n      setStoryCards(cards);\n    } catch (err) {\n      console.error(\"검색 오류:\", err);\n      setError(\"검색 중 오류가 발생했습니다. 다시 시도해주세요.\");\n    } finally {\n      setIsLoading(false);\n    }\n  }, [nickname]);\n\n  // 이미지 다운로드\n  const handleDownload = useCallback(async (card: StoryCard) => {\n    try {\n      const response = await fetch(card.publicUrl);\n      const blob = await response.blob();\n      const url = window.URL.createObjectURL(blob);\n      const a = document.createElement(\"a\");\n      a.href = url;\n      a.download = card.name;\n      document.body.appendChild(a);\n      a.click();\n      document.body.removeChild(a);\n      window.URL.revokeObjectURL(url);\n    } catch (err) {\n      console.error(\"다운로드 오류:\", err);\n      alert(\"다운로드 중 오류가 발생했습니다\");\n    }\n  }, []);\n\n  // Enter 키 처리\n  const handleKeyDown = useCallback(\n    (e: React.KeyboardEvent) => {\n      if (e.key === \"Enter\" && !isLoading) {\n        handleSearch();\n      }\n    },\n    [handleSearch, isLoading]\n  );\n\n  return (\n    <main style={styles.main}>\n      <div style={styles.container}>\n        {/* 헤더 */}\n        <header style={styles.header}>\n          <h1 style={styles.logo}>MoodTrip</h1>\n          <p style={styles.subtitle}>스토리 카드 다운로드</p>\n        </header>\n\n        {/* 검색 섹션 */}\n        <section style={styles.searchSection}>\n          <p style={styles.instruction}>\n            전시회에서 사용한 닉네임을 입력해주세요\n          </p>\n          <div style={styles.inputWrapper}>\n            <input\n              type=\"text\"\n              value={nickname}\n              onChange={(e) => setNickname(e.target.value)}\n              onKeyDown={handleKeyDown}\n              placeholder=\"닉네임 입력\"\n              style={styles.input}\n              disabled={isLoading}\n            />\n            <button\n              onClick={handleSearch}\n              disabled={isLoading || !nickname.trim()}\n              style={{\n                ...styles.searchButton,\n                opacity: isLoading || !nickname.trim() ? 0.5 : 1,\n              }}\n            >\n              {isLoading ? \"검색중...\" : \"검색\"}\n            </button>\n          </div>\n\n          {error && <p style={styles.error}>{error}</p>}\n        </section>\n\n        {/* 결과 섹션 */}\n        {storyCards.length > 0 && (\n          <section style={styles.resultSection}>\n            <h2 style={styles.resultTitle}>\n              {userName}님의 스토리 카드 ({storyCards.length}개)\n            </h2>\n            <div style={styles.cardGrid}>\n              {storyCards.map((card, index) => (\n                <div key={index} style={styles.card}>\n                  <div style={styles.cardImageWrapper}>\n                    <img\n                      src={card.publicUrl}\n                      alt={`스토리 카드 ${index + 1}`}\n                      style={styles.cardImage}\n                    />\n                  </div>\n                  <button\n                    onClick={() => handleDownload(card)}\n                    style={styles.downloadButton}\n                  >\n                    다운로드\n                  </button>\n                </div>\n              ))}\n            </div>\n          </section>\n        )}\n\n        {/* 푸터 */}\n        <footer style={styles.footer}>\n          <p>MoodTrip - AI와 함께하는 감성 여행</p>\n        </footer>\n      </div>\n    </main>\n  );\n}\n\nconst styles: { [key: string]: React.CSSProperties } = {\n  main: {\n    minHeight: \"100vh\",\n    display: \"flex\",\n    flexDirection: \"column\",\n    alignItems: \"center\",\n    padding: \"20px\",\n  },\n  container: {\n    width: \"100%\",\n    maxWidth: \"430px\",\n    display: \"flex\",\n    flexDirection: \"column\",\n    alignItems: \"center\",\n    gap: \"32px\",\n  },\n  header: {\n    textAlign: \"center\",\n    paddingTop: \"40px\",\n  },\n  logo: {\n    fontSize: \"32px\",\n    fontWeight: \"700\",\n    color: \"#ffffff\",\n    marginBottom: \"8px\",\n  },\n  subtitle: {\n    fontSize: \"16px\",\n    color: \"rgba(255, 255, 255, 0.7)\",\n  },\n  searchSection: {\n    width: \"100%\",\n    display: \"flex\",\n    flexDirection: \"column\",\n    gap: \"16px\",\n  },\n  instruction: {\n    fontSize: \"14px\",\n    color: \"rgba(255, 255, 255, 0.8)\",\n    textAlign: \"center\",\n  },\n  inputWrapper: {\n    display: \"flex\",\n    gap: \"12px\",\n    width: \"100%\",\n  },\n  input: {\n    flex: 1,\n    padding: \"14px 16px\",\n    fontSize: \"16px\",\n    borderRadius: \"12px\",\n    border: \"1px solid rgba(255, 255, 255, 0.2)\",\n    backgroundColor: \"rgba(255, 255, 255, 0.1)\",\n    color: \"#ffffff\",\n    outline: \"none\",\n  },\n  searchButton: {\n    padding: \"14px 24px\",\n    fontSize: \"16px\",\n    fontWeight: \"600\",\n    borderRadius: \"12px\",\n    border: \"none\",\n    backgroundColor: \"#4A90D9\",\n    color: \"#ffffff\",\n    cursor: \"pointer\",\n    transition: \"all 0.2s ease\",\n  },\n  error: {\n    color: \"#ff6b6b\",\n    fontSize: \"14px\",\n    textAlign: \"center\",\n  },\n  resultSection: {\n    width: \"100%\",\n    display: \"flex\",\n    flexDirection: \"column\",\n    gap: \"20px\",\n  },\n  resultTitle: {\n    fontSize: \"18px\",\n    fontWeight: \"600\",\n    color: \"#ffffff\",\n  },\n  cardGrid: {\n    display: \"grid\",\n    gridTemplateColumns: \"repeat(2, 1fr)\",\n    gap: \"16px\",\n    width: \"100%\",\n  },\n  card: {\n    display: \"flex\",\n    flexDirection: \"column\",\n    gap: \"12px\",\n    backgroundColor: \"rgba(255, 255, 255, 0.05)\",\n    borderRadius: \"12px\",\n    padding: \"12px\",\n  },\n  cardImageWrapper: {\n    width: \"100%\",\n    aspectRatio: \"9/16\",\n    borderRadius: \"8px\",\n    overflow: \"hidden\",\n    backgroundColor: \"rgba(0, 0, 0, 0.2)\",\n  },\n  cardImage: {\n    width: \"100%\",\n    height: \"100%\",\n    objectFit: \"cover\",\n  },\n  downloadButton: {\n    padding: \"10px 16px\",\n    fontSize: \"14px\",\n    fontWeight: \"600\",\n    borderRadius: \"8px\",\n    border: \"none\",\n    backgroundColor: \"#4A90D9\",\n    color: \"#ffffff\",\n    cursor: \"pointer\",\n    transition: \"all 0.2s ease\",\n  },\n  footer: {\n    marginTop: \"auto\",\n    paddingTop: \"40px\",\n    paddingBottom: \"20px\",\n    textAlign: \"center\",\n    fontSize: \"12px\",\n    color: \"rgba(255, 255, 255, 0.5)\",\n  },\n};\n"],"names":[],"mappings":"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"}}]
}